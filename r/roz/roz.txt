2つの文字を選んで、片方に+1,もう片方に-1の重みを割り当てる。
そして、他の文字を無視して最大重みの区間を求める。このとき、-1が最低1つは含まれるもののみを考える。

これで元の問題も解けている。